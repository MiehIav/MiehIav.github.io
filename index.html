<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Real-Time Global Earthquake Tracker</title>
  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <style>
    /* Use full viewport without scrolling */
    html, body {
      height: 100%;
      margin: 0;
      overflow: hidden;
    }
    /* Map container fills the entire screen */
    #map {
      width: 100%;
      height: 100%;
    }
    /* Styling for the update control */
    .update-info {
      background: rgba(255, 255, 255, 0.9);
      padding: 8px 12px;
      border-radius: 4px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.3);
      font-family: Arial, sans-serif;
      font-size: 14px;
    }
    /* Container for the feed selector dropdown */
    #feedSelectorContainer {
      position: absolute;
      top: 10px;
      left: 10px;
      z-index: 1000;
      background: rgba(255, 255, 255, 0.95);
      padding: 8px 12px;
      border-radius: 4px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.3);
      font-family: Arial, sans-serif;
      font-size: 14px;
    }
    #feedSelector {
      font-size: 14px;
    }
  </style>
</head>
<body>
  <!-- Dropdown for selecting the earthquake feed -->
  <div id="feedSelectorContainer">
    <label for="feedSelector">Earthquake Feed:</label>
    <select id="feedSelector">
      <option value="all_hour">All Earthquakes</option>
      <option value="1.0_hour">Magnitude 1.0+</option>
      <option value="2.5_hour">Magnitude 2.5+</option>
      <option value="4.5_hour">Magnitude 4.5+</option>
      <option value="significant_hour">Significant</option>
    </select>
  </div>
  
  <!-- Map container -->
  <div id="map"></div>

  <!-- Leaflet JavaScript library -->
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script>
    // Define world bounds (to restrict panning)
    var southWest = L.latLng(-90, -180),
        northEast = L.latLng(90, 180),
        bounds = L.latLngBounds(southWest, northEast);

    // Initialize the map:
    // - worldCopyJump makes panning seamless when switching between wrapped worlds.
    // - maxBounds restricts panning to the real world.
    var map = L.map('map', {
      worldCopyJump: true,
      maxBounds: bounds,
      maxBoundsViscosity: 1.0
    }).setView([0, 0], 2);

    // Add OpenStreetMap tile layer with noWrap enabled to prevent duplicate tiles.
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; OpenStreetMap contributors',
      noWrap: true
    }).addTo(map);

    // Create a layer group for earthquake markers.
    var earthquakeLayer = L.layerGroup().addTo(map);

    // Custom control for showing the last update time.
    var lastUpdatedControl = L.control({ position: 'bottomright' });
    lastUpdatedControl.onAdd = function(map) {
      var div = L.DomUtil.create('div', 'update-info');
      div.innerHTML = 'Last Updated: N/A';
      return div;
    };
    lastUpdatedControl.addTo(map);

    // Current feed type (default is "all_hour").
    var currentFeed = document.getElementById('feedSelector').value;

    // Fetch earthquake data from USGS and update markers.
    function fetchEarthquakes() {
      var feedUrl = 'https://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/' + currentFeed + '.geojson';
      fetch(feedUrl)
        .then(response => response.json())
        .then(data => {
          earthquakeLayer.clearLayers();
          data.features.forEach(feature => {
            var coords = feature.geometry.coordinates;
            var lat = coords[1],
                lng = coords[0],
                magnitude = feature.properties.mag,
                place = feature.properties.place,
                time = new Date(feature.properties.time).toLocaleString();

            // Create a circle marker; size and color depend on the magnitude.
            var marker = L.circleMarker([lat, lng], {
              radius: magnitude * 3,
              fillColor: getColor(magnitude),
              color: '#333',
              weight: 1,
              opacity: 1,
              fillOpacity: 0.8
            }).bindPopup(
              `<strong>${place}</strong><br>Magnitude: ${magnitude}<br>Time: ${time}`
            );
            marker.addTo(earthquakeLayer);
          });
          // Update last updated timestamp.
          document.querySelector('.update-info').innerHTML = 'Last Updated: ' + new Date().toLocaleString();
        })
        .catch(error => console.error('Error fetching earthquake data:', error));
    }

    // Helper function to determine marker color based on magnitude.
    function getColor(mag) {
      return mag > 5 ? '#d73027' :
             mag > 4 ? '#fc8d59' :
             mag > 3 ? '#fee08b' :
             mag > 2 ? '#d9ef8b' :
             mag > 1 ? '#91cf60' :
                       '#1a9850';
    }

    // Update the feed when the selection changes.
    document.getElementById('feedSelector').addEventListener('change', function() {
      currentFeed = this.value;
      fetchEarthquakes();
    });

    // Initial fetch and automatic updates every 60 seconds.
    fetchEarthquakes();
    setInterval(fetchEarthquakes, 60000);
  </script>
</body>
</html>
